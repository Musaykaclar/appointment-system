@using Microsoft.AspNetCore.Components.Routing
@using AppointmentSystem.Application.DTOs
@using AppointmentSystem.Web.Services
@inject AuthStateService AuthState
@inject NavigationManager Navigation

<nav class="sidebar-nav">
    @if (AuthState.IsAuthenticated)
    {
        <div class="user-info">
            <div class="user-name">@AuthState.CurrentUser?.FullName</div>
            <div class="user-role">@(AuthState.IsAdmin ? "Yönetici" : "Kullanıcı")</div>
        </div>
        
        @if (AuthState.IsAdmin)
        {
            @* Yönetici için sadece Yönetici Paneli *@
            <NavLink href="/admin-appointments" class="sidebar-link">
                <span class="nav-icon">⚙️</span>
                <span class="nav-text">Yönetici Paneli</span>
            </NavLink>
        }
        else
        {
            @* Kullanıcı için Randevularım ve Randevu Talep Formu *@
            <NavLink href="/appointments" class="sidebar-link" Match="NavLinkMatch.Prefix">
                <span class="nav-icon">📋</span>
                <span class="nav-text">Randevularım</span>
            </NavLink>
            
            <NavLink href="/appointment-form" class="sidebar-link">
                <span class="nav-icon">➕</span>
                <span class="nav-text">Randevu Talep Formu</span>
            </NavLink>
        }
        
        <div class="sidebar-link logout-link" @onclick="HandleLogout">
            <span class="nav-icon">🚪</span>
            <span class="nav-text">Çıkış Yap</span>
        </div>
    }
    else
    {
        <NavLink href="/login" class="sidebar-link">
            <span class="nav-icon">🔐</span>
            <span class="nav-text">Giriş Yap</span>
        </NavLink>
        
        <NavLink href="/register" class="sidebar-link">
            <span class="nav-icon">📝</span>
            <span class="nav-text">Kayıt Ol</span>
        </NavLink>
    }
</nav>

@code {
    protected override void OnInitialized()
    {
        AuthState.OnAuthStateChanged += StateHasChanged;
    }

    private async Task HandleLogout()
    {
        await AuthState.LogoutAsync();
        Navigation.NavigateTo("/login");
    }
}
